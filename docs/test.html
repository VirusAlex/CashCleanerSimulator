<!DOCTYPE html>
<html>
<head>
    <title>Cash Cleaner Optimizer - Algorithm Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Cash Cleaner Optimizer - Algorithm Test</h1>
    
    <div id="test-results"></div>

    <script>
        // Copy core optimization logic from main file
        const BUNDLE_SIZE = 100;
        const BLOCK_SIZE = 30;
        const INFINITY = 1000000000;

        const CURRENCIES = {
            'USD': [100, 50, 20, 10],
            'EUR': [100, 50, 20],
            'JPY': [10000, 5000, 1000]
        };

        // Core optimization functions (simplified for testing)
        function searchBlocks(denoms, blocks, i, bundlesLeft, valueLeft, cur, solutions, stock) {
            if (i === denoms.length - 1) {
                const d = denoms[i];
                const neededBundles = d ? Math.floor(valueLeft / d) : 0;
                if (valueLeft === d * neededBundles && 
                    neededBundles === bundlesLeft && 
                    neededBundles <= stock[d]) {
                    cur[i] = neededBundles;
                    solutions.push([blocks, [...cur]]);
                }
                return;
            }

            const d = denoms[i];
            const maxForD = Math.min(bundlesLeft, stock[d], Math.floor(valueLeft / d));
            
            for (let b = 0; b <= maxForD; b++) {
                cur[i] = b;
                searchBlocks(denoms, blocks, i + 1, bundlesLeft - b, valueLeft - d * b, cur, solutions, stock);
            }
            cur[i] = 0;
        }

        function normalizeStock(denoms, bundlesStock) {
            const stock = {};
            denoms.forEach(d => stock[d] = bundlesStock && bundlesStock[d] ? bundlesStock[d] : INFINITY);
            return stock;
        }

        function findIdealBlockVariants(amount, currencyCode, maxVariants = 5, bundlesStock = null) {
            const denoms = CURRENCIES[currencyCode.toUpperCase()];
            if (!denoms) return [];
            
            if (amount % BUNDLE_SIZE !== 0) return [];

            const units = Math.floor(amount / BUNDLE_SIZE);
            const denomsSorted = [...denoms].sort((a, b) => b - a);
            const stock = normalizeStock(denomsSorted, bundlesStock);

            const smallestBundleValue = Math.min(...denomsSorted) * BUNDLE_SIZE;
            const theoreticalMaxBlocks = Math.floor(amount / (smallestBundleValue * BLOCK_SIZE));
            
            const totalStockBundles = denomsSorted.reduce((sum, d) => sum + stock[d], 0);
            const maxBlocks = Math.min(theoreticalMaxBlocks, Math.floor(totalStockBundles / BLOCK_SIZE));

            const solutions = [];
            const cur = new Array(denomsSorted.length).fill(0);

            for (let blocks = 1; blocks <= maxBlocks; blocks++) {
                const bundlesTotal = blocks * BLOCK_SIZE;
                if (bundlesTotal > totalStockBundles) break;
                
                searchBlocks(denomsSorted, blocks, 0, bundlesTotal, units, cur, solutions, stock);
            }

            return solutions.slice(0, maxVariants);
        }

        // Test cases
        const testCases = [
            {
                name: "USD - Basic ideal blocks",
                amount: 300000,
                currency: "USD",
                stock: null,
                expected: "Should find ideal blocks"
            },
            {
                name: "USD - Limited stock",
                amount: 750000,
                currency: "USD", 
                stock: {100: 18, 50: 40},
                expected: "Should find variants with stock limits"
            },
            {
                name: "EUR - Small amount",
                amount: 15000,
                currency: "EUR",
                stock: null,
                expected: "Should find solutions"
            },
            {
                name: "JPY - Large amount",
                amount: 3000000,
                currency: "JPY",
                stock: null,
                expected: "Should find ideal blocks"
            },
            {
                name: "Invalid amount (not divisible by 100)",
                amount: 12345,
                currency: "USD",
                stock: null,
                expected: "Should return empty array"
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let html = '';

            testCases.forEach((testCase, index) => {
                try {
                    const startTime = performance.now();
                    const results = findIdealBlockVariants(
                        testCase.amount, 
                        testCase.currency, 
                        5, 
                        testCase.stock
                    );
                    const endTime = performance.now();
                    const duration = (endTime - startTime).toFixed(2);

                    const success = results !== null;
                    const cssClass = success ? 'success' : 'error';
                    
                    html += `
                        <div class="test-case ${cssClass}">
                            <h3>Test ${index + 1}: ${testCase.name}</h3>
                            <p><strong>Input:</strong> ${testCase.amount.toLocaleString()} ${testCase.currency}</p>
                            <p><strong>Stock:</strong> ${testCase.stock ? JSON.stringify(testCase.stock) : 'Unlimited'}</p>
                            <p><strong>Expected:</strong> ${testCase.expected}</p>
                            <p><strong>Results:</strong> ${results.length} variants found</p>
                            <p><strong>Performance:</strong> ${duration} ms</p>
                            <details>
                                <summary>View Results</summary>
                                <pre>${JSON.stringify(results, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } catch (error) {
                    html += `
                        <div class="test-case error">
                            <h3>Test ${index + 1}: ${testCase.name}</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                        </div>
                    `;
                }
            });

            resultsDiv.innerHTML = html;
        }

        // Run tests on page load
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html> 